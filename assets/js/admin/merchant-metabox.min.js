"use strict";!function(r){r.fn.merchantMetabox=function(){return this.each(function(){var e=r(this),t=e.find(".merchant-metabox-tab"),n=e.find(".merchant-metabox-content"),i=(t.each(function(){var t=r(this);t.on("click",function(e){e.preventDefault();e=n.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),r(document).trigger("merchant-metabox-content-show",e)})}),n.find(".merchant-metabox-field-repeater")),o=(i.length&&i.each(function(){var n=r(this).find("ul");n.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-repeater-move"}),i.find(".merchant-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var e=n.find("li").first().clone(!0),t=e.find("input");t.attr("name",t.data("name")),e.removeClass("hidden"),n.append(e)}),i.find(".merchant-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),r(this).closest("li").remove()})}),n.find(".merchant-metabox-field-uploads")),a=(o.length&&o.each(function(){var n,i,a=r(this).find("ul");a.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-uploads-move"}),o.find(".merchant-metabox-field-uploads-add").on("click",function(e){e.preventDefault();var t=a.find("li"),e=t.first().clone(!0);e.find("input").each(function(){r(this).attr("name",r(this).data("name").replace("0",t.length))}),e.removeClass("hidden"),a.append(e)}),o.find(".merchant-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),i=r(this).closest("li").find(" > input"),n&&n.options.library.type===a.data("library")?n.open():(n=window.wp.media({library:{type:a.data("library")||"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON();i.val(e.url)})}),o.find(".merchant-metabox-field-uploads-thumbnail-upload").on("click",function(e){e.preventDefault(),i=r(this).parent().find("input"),n&&"image"===n.options.library.type?n.open():(n=window.wp.media({library:{type:"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=i.parent();i.val(e.id),t.find("span").hide(),t.find("img").remove(),t.find(".merchant-metabox-field-uploads-thumbnail-remove").show(),t.find(".merchant-metabox-field-uploads-thumbnail-upload").append(r("<img>").attr({src:e.url}))})}),o.find(".merchant-metabox-field-uploads-thumbnail-remove").on("click",function(e){e.preventDefault();e=r(this).parent();e.find("span").show(),e.find("img").remove(),e.find("input").val(""),e.find(".merchant-metabox-field-uploads-thumbnail-remove").hide()}),o.find(".merchant-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),r(this).closest("li").remove()})}),n.find(".merchant-metabox-field-size-chart")),e=(a.length&&(a.on("multidimensional",function(e,t){(t||a).find("input").each(function(){var e=r(this),t=Math.max(0,e.closest("li").index()-1),n=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+n+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),a.each(function(){var t=r(this).find("ul");a.on("click",".merchant-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){r(this).attr("name",r(this).data("name")),r(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),a.trigger("multidimensional",[e])}),a.on("click",".merchant-add-col",function(e){e.preventDefault();var e=r(this).closest("td"),t=r(this).closest("table");r(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")").each(function(){var e=r(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),a.trigger("multidimensional",[t])}),a.on("click",".merchant-del-col",function(e){e.preventDefault();var e=r(this).closest("td"),t=r(this).closest("table"),n=r(this).closest("tr").find("td").length,e=r(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")");2<n?e.remove():e.find("input").val(""),a.trigger("multidimensional",[t])}),a.on("click",".merchant-add-row",function(e){e.preventDefault();var e=r(this).closest("tr"),t=r(this).closest("table"),n=e.clone(!0);n.find("input").val(""),e.after(n),a.trigger("multidimensional",[t])}),a.on("click",".merchant-del-row",function(e){e.preventDefault();var e=r(this).closest("tr"),t=r(this).closest("table");2<r(this).closest("tbody").find("tr").length?e.remove():e.find("input").val(""),a.trigger("multidimensional",[t])}),a.on("click",".merchant-remove",function(e){e.preventDefault(),r(this).closest("li").remove(),a.trigger("multidimensional")}),a.on("click",".merchant-duplicate",function(e){e.preventDefault();var e=r(this).closest("li"),t=e.clone(!0);e.after(t),a.trigger("multidimensional")})})),r(".merchant-metabox-field-media")),d=(e.length&&e.each(function(){var n,e=r(this),i=e.find(".merchant-metabox-field-media-input"),a=e.find(".merchant-metabox-field-media-preview img"),t=e.find(".merchant-metabox-field-media-upload"),o=e.find(".merchant-metabox-field-media-remove"),d=a.data("placeholder");t.on("click",function(e){e.preventDefault(),n||(n=window.wp.media({library:{type:"image"}})).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;i.val(e.id),a.attr("src",t),o.removeClass("hidden")}),n.open()}),o.on("click",function(e){e.preventDefault(),i.val(""),a.attr("src",d),o.addClass("hidden")})}),r(".merchant-metabox-field-select-ajax")),t=(d.length&&d.each(function(){var e=r(this).find("select"),t=e.data("source"),n=window.merchant_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:n.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"merchant_select_ajax",nonce:n.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),d.find(".select2-selection--multiple").append('<span class="merchant-select2-clear"></span>')}),r(".merchant-metabox-field-wc-attributes")),e=(t.length&&t.each(function(){r(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),r(document).on("merchant-metabox-content-show",function(e,t){var n,t=r(t);t.data("code-editor-initalized")||((n=r(".merchant-metabox-field-code-editor",t)).length&&n.each(function(){var e=r(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),t.data("code-editor-initalized",!0))}),n.find("[data-depend-on]"));e.length&&e.each(function(){var t=r(this),e=n.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=n.find('[data-depend-on="'+t.data("depend-on")+'"]');r(this).is(":checked")?e.removeClass("merchant-metabox-field-hidden"):e.addClass("merchant-metabox-field-hidden")}),e.data("depend-on",!0))})})},r(document).ready(function(e){e(".merchant-metabox").merchantMetabox()})}(jQuery);