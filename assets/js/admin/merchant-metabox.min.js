"use strict";!function(c){c.fn.merchantMetabox=function(){function d(i){i.each(function(){var e=c(this).find("select"),t=e.data("source"),n=window.merchant_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:n.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"merchant_select_ajax",nonce:n.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),i.find(".select2-selection--multiple").append('<span class="merchant-select2-clear"></span>')})}return this.each(function(){var e=c(this),t=e.find(".merchant-metabox-tab"),n=e.find(".merchant-metabox-content"),i=(t.each(function(){var t=c(this);t.on("click",function(e){e.preventDefault();e=n.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),c(document).trigger("merchant-metabox-content-show",e)})}),n.find(".merchant-metabox-field-flexible-content")),a=(i.length&&i.each(function(){var a=".merchant-metabox-field-flexible-content-select-ajax",l=c(a),n=(l.length&&d(l),c(this).find(".merchant-metabox-field-flexible-content-list"));n.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-flexible-content-move",stop:function(e,t){n.find("> li").each(function(e){var t=".merchant-metabox-field-flexible-content-item-count",n=c(this).find(t).text(),i=parseInt(n)-1;c(this).find(t).text(e),c(this).find("input, select").each(function(){c(this).attr("name")&&c(this).attr("name",c(this).attr("name").replace("["+i+"]","["+(e-1)+"]"))})})}}),i.find(".merchant-metabox-field-flexible-content-add-button").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),c(this).parent().find(".merchant-metabox-field-flexible-content-add-list").toggleClass("active")}),i.find(".merchant-metabox-field-flexible-content-add").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=c(".merchant-metabox-field-flexible-content-list[data-id="+c(this).data("id")+"]"),t=c(this).data("layout"),n=e.find("> li"),i=e.find("> li").first().clone(!0);i.find(" > div").each(function(){c(this).data("layout")!==t||c(this).children().appendTo(c(this).parent()),c(this).remove()}),i.find("input, select").each(function(){c(this).data("name")&&c(this).attr("name",c(this).data("name").replace("0",n.length-1))}),i.find(".merchant-metabox-field-flexible-content-item-count").text(n.length),i.find(".merchant-metabox-field-flexible-content-select-ajax-clone").each(function(){c(this).removeClass("merchant-metabox-field-flexible-content-select-ajax-clone"),c(this).addClass("merchant-metabox-field-flexible-content-select-ajax")}),i.removeClass("hidden"),e.append(i),(l=c(a)).length&&d(l),c(this).parent().removeClass("active"),e.removeClass("empty")}),i.find(".merchant-metabox-field-flexible-content-remove").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=c(this).closest("li"),t=e.parent();e.remove(),1===t.find(">li").length&&t.addClass("empty")})}),n.find(".merchant-metabox-field-repeater, .merchant-metabox-field-flexible-content-repeater")),l=(a.length&&a.each(function(){var i=c(this).find("ul");i.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-repeater-move"}),a.find(".merchant-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var t=i.find("li"),e=i.find("li").first().clone(!0),n=e.find("input");e.find(".merchant-metabox-field-repeater-list-item-fields").length?e.find("input").each(function(){c(this).attr("name",c(this).data("name").replace("0",t.length-1))}):n.attr("name",n.data("name")),e.removeClass("hidden"),i.append(e)}),a.find(".merchant-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),c(this).closest("li").remove()})}),n.find(".merchant-metabox-field-uploads")),o=(l.length&&l.each(function(){var n,i,t=c(this).find("ul");t.sortable({axis:"y",cursor:"move",helper:"original",handle:".merchant-metabox-field-uploads-move"}),l.find(".merchant-metabox-field-uploads-add").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var e=c(this).parent().find("ul"),t=e.find("li"),n=t.first().clone(!0);n.find("input").each(function(){c(this).attr("name",c(this).data("name").replace("0",t.length))}),n.removeClass("hidden"),e.append(n)}),l.find(".merchant-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),(i=c(this).closest("li").find(" > input")).attr("name").length&&(n&&n.options.library.type===t.data("library")?n.open():(n=window.wp.media({library:{type:t.data("library")||"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON();i.val(e.url)}))}),l.find(".merchant-metabox-field-uploads-thumbnail-upload").on("click",function(e){e.preventDefault(),(i=c(this).parent().find("input")).attr("name").length&&(n&&"image"===n.options.library.type?n.open():(n=window.wp.media({library:{type:"image"}}).open()).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=i.parent();i.val(e.id),t.find("span").hide(),t.find("img").remove(),t.find(".merchant-metabox-field-uploads-thumbnail-remove").show(),t.find(".merchant-metabox-field-uploads-thumbnail-upload").append(c("<img>").attr({src:e.url}))}))}),l.find(".merchant-metabox-field-uploads-thumbnail-remove").on("click",function(e){e.preventDefault();e=c(this).parent();e.find("span").show(),e.find("img").remove(),e.find("input").val(""),e.find(".merchant-metabox-field-uploads-thumbnail-remove").hide()}),l.find(".merchant-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),c(this).closest("li").remove()})}),n.find(".merchant-metabox-field-size-chart")),e=(o.length&&(o.on("multidimensional",function(e,t){(t||o).find("input").each(function(){var e=c(this),t=Math.max(0,e.closest("li").index()-1),n=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+n+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),o.each(function(){var t=c(this).find("ul");o.on("click",".merchant-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){c(this).attr("name",c(this).data("name")),c(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),o.trigger("multidimensional",[e])}),o.on("click",".merchant-add-col",function(e){e.preventDefault();var e=c(this).closest("td"),t=c(this).closest("table");c(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")").each(function(){var e=c(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),o.trigger("multidimensional",[t])}),o.on("click",".merchant-del-col",function(e){e.preventDefault();var e=c(this).closest("td"),t=c(this).closest("table"),n=c(this).closest("tr").find("td").length,e=c(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")");2<n?e.remove():e.find("input").val(""),o.trigger("multidimensional",[t])}),o.on("click",".merchant-add-row",function(e){e.preventDefault();var e=c(this).closest("tr"),t=c(this).closest("table"),n=e.clone(!0);n.find("input").val(""),e.after(n),o.trigger("multidimensional",[t])}),o.on("click",".merchant-del-row",function(e){e.preventDefault();var e=c(this).closest("tr"),t=c(this).closest("table");2<c(this).closest("tbody").find("tr").length?e.remove():e.find("input").val(""),o.trigger("multidimensional",[t])}),o.on("click",".merchant-remove",function(e){e.preventDefault(),c(this).closest("li").remove(),o.trigger("multidimensional")}),o.on("click",".merchant-duplicate",function(e){e.preventDefault();var e=c(this).closest("li"),t=e.clone(!0);e.after(t),o.trigger("multidimensional")})})),c(".merchant-metabox-field-media")),t=(e.length&&e.each(function(){var n,e=c(this),i=e.find(".merchant-metabox-field-media-input"),a=e.find(".merchant-metabox-field-media-preview img"),t=e.find(".merchant-metabox-field-media-upload"),l=e.find(".merchant-metabox-field-media-remove"),o=a.data("placeholder");t.on("click",function(e){e.preventDefault(),n||(n=window.wp.media({library:{type:"image"}})).on("select",function(){var e=n.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;i.val(e.id),a.attr("src",t),l.removeClass("hidden")}),n.open()}),l.on("click",function(e){e.preventDefault(),i.val(""),a.attr("src",o),l.addClass("hidden")})}),c(".merchant-metabox-field-select-ajax")),e=(t.length&&d(t),c(".merchant-metabox-field-wc-attributes")),t=(e.length&&e.each(function(){c(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),c(document).on("merchant-metabox-content-show",function(e,t){var n,t=c(t);t.data("code-editor-initalized")||((n=c(".merchant-metabox-field-code-editor",t)).length&&n.each(function(){var e=c(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),t.data("code-editor-initalized",!0))}),n.find("[data-depend-on]"));t.length&&t.each(function(){var t=c(this),e=n.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=n.find('[data-depend-on="'+t.data("depend-on")+'"]');c(this).is(":checked")?e.removeClass("merchant-metabox-field-hidden"):e.addClass("merchant-metabox-field-hidden")}),e.data("depend-on",!0))})})},c(document).ready(function(e){e(".merchant-metabox").merchantMetabox()})}(jQuery);